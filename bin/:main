#!/bin/sh

AE_API=`dirname $0`
AE_CMD=`basename $0`

cd ${AE_API}

[ ! -f matrix ] && echo "matrix file missing at `pwd`" && exit 5

AE_MATRIX="${AE_API}/matrix"
AE_BIN=`readlink ${AE_CMD} | xargs dirname`

cd $AE_BIN


. :bomb
. :val
. :array
. :math
. :string
. :http
. :json
. :specs
. :param
. :line
. :req
. :url
. :util
. :hooks
. :session
. :auth
. :response
. :common $*
. ^filter
. ^collapse

shift

. ^cmdline

hooks_pre ${AE_CMD} $*

line_locate
 req_build
 url_build

http_payload
. ^cookie
. ^session

echo LINE: ${__line}
#echo PAYLOAD: ${__payload}
#echo URL: ${__url}

set -x
> ${AE_HTTPCODE} curl                      \
    ${AE_COOKIES}                          \
    ${AE_CSRF}                             \
    -s                                     \
    -X ${AE_METHOD}                        \
    ${AE_DATA}                             \
    -o ${AE_RESPONSE}                      \
    -w %{http_code}                        \
    ${AE_HOST}:${AE_PORT}${__url}
set +x

response_get

http_code
hooks_post ${AE_CMD} $*
auth_checks

echo "[${__response}]" | jshon -e 1
