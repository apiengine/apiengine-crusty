#!/bin/sh

line_available() {
    _lines=`wc -l ${AE_COLLAPSED} | cut -c7-8`
    if [ ${_lines} = 0 ]; then
        bomb_fail "no entries for [${AE_CMD}]"
    fi
}

line_locate() {
    line_available
    _line="__not_found__"
    while read __
    do
        specs_split $__
        if [ "${_method}" = "${AE_CRUD}" ]; then 
            param_build "_args" ${_args}
            line_cmdline_match "_args"
            if [ "$__" = "true" ]; then
                if [ "${_line}" != "__not_found__" ]; then
                    bomb_fail "only one matching line allowed"
                fi
                _line=$__
            fi
        fi        
    done < ${AE_COLLAPSED}
    if [ "${_line}" == "__not_found__" ]; then
        bomb_fail "no entry for [${AE_CMD} ${AE_CRUD}]"
    fi
}


# FIX robably lives somewhere else
line_cmdline_match() {
    array_len "_args_m"; _alen=$__
    array_len "_cmdline"; _clen=$__
    array_last "_cmdline"
    json_is "$__"
    if [ "$__" = "true" ]; then
        math_inc "_alen"    
    fi
    if [ ${_alen} != ${_clen} ]; then
        bomb_cmdfail "incorrect parameter count: expected ${_alen}, provided ${_clen}"
    fi
}

