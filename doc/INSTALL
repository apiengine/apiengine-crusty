#!/bin/sh

set -e

CRUSTY_HOME=$HOME/.crusty

[ ! -f $CRUSTY_HOME ] && echo "creating $CRUSTY_HOME" && mkdir -p $CRUSTY_HOME

if [ ! -f $CRUSTY_HOME/jansson ]; then
    echo "installing jansson..."
    cd $CRUSTY_HOME
    curl http://www.digip.org/jansson/releases/jansson-2.3.1.tar.gz | tar zxf -
    ln -s jansson* jansson
    cd jansson
    ./configure
    make
fi

if [ ! -f $CRUSTY_HOME/jshon ]; then
    echo "installing jshon..."
    cd $CRUSTY_HOME
    curl http://kmkeen.com/jshon/jshon.tar.gz | \
    tar zxf -
    cd jshon
    export C_INCLUDE_PATH=$CRUSTY_HOME/jansson/src
    export LIBRARY_PATH=$CRUSTY_HOME/jansson/src/.libs
    make
fi

echo; echo; echo; echo; echo
echo 'BRILLIANT!'
echo
echo 'now add the following lines to your ~/.profile or equivalent:'
echo
[ "`uname -s`" = "Darwin" ] && sprinkle=DY
echo '    export CRUSTY_HOME='${CRUSTY_HOME}
echo '    export PATH=$CRUSTY_HOME/jshon:$PATH'
echo '    export '$sprinkle'LD_LIBRARY_PATH=$CRUSTY_HOME/jansson/src/.libs'
echo
echo 'then check jshon runs:'
echo
echo '    echo '\''{"msg":"rockin"}'\'' | jshon -e msg'
echo
echo 'time to move on to CONFIGURATION...'
